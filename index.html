<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Couloir TSA - 5 portes</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script>
    // Composant pour ouvrir la porte automatiquement quand le joueur s'approche
    AFRAME.registerComponent('open-on-approach', {
      schema: { distance: { type: 'number', default: 2 } },
      tick: function () {
        const player = document.querySelector('#player');
        const doorPos = this.el.object3D.position;
        const playerPos = player.object3D.position;
        const dx = playerPos.x - doorPos.x;
        const dz = playerPos.z - doorPos.z;
        const dist = Math.sqrt(dx*dx + dz*dz);
        if (dist < this.data.distance) {
          this.el.setAttribute('rotation', '0 90 0'); // ouvre la porte
        } else {
          this.el.setAttribute('rotation', '0 0 0'); // ferme la porte
        }
      }
    });
  </script>
</head>
<body>
  <a-scene>
    <!-- Assets -->
    <a-assets>
      <a-asset-item id="doorModel" src="assets/door.glb"></a-asset-item>
    </a-assets>

    <!-- Couloir noir centré devant la caméra -->
    <a-box position="0 1.5 -15" depth="20" height="3" width="5" color="#000"></a-box>

    <!-- Portes et zones de téléportation -->
    <script>
      const scene = document.querySelector('a-scene');
      const numberOfDoors = 5;
      for (let i = 1; i <= numberOfDoors; i++) {
        const zPos = -2.5 * i - 5; // Commence à l'intérieur du couloir

        // Porte GLB
        const door = document.createElement('a-entity');
        door.setAttribute('gltf-model', '#doorModel');
        door.setAttribute('position', `0 0 ${zPos}`);
        door.setAttribute('scale', '0.01 0.01 0.01'); // très fine
        door.setAttribute('open-on-approach', 'distance:2');
        scene.appendChild(door);

        // Zone invisible pour téléportation
        const zone = document.createElement('a-box');
        zone.setAttribute('position', `0 1.6 ${zPos}`);
        zone.setAttribute('depth', '1');
        zone.setAttribute('height', '3');
        zone.setAttribute('width', '5');
        zone.setAttribute('visible', 'false');
        zone.setAttribute('id', `teleport${i}`);
        scene.appendChild(zone);
      }
    </script>

    <!-- Camera / joueur -->
    <a-entity id="player" position="0 1.6 0" camera wasd-controls look-controls>
      <a-camera>
        <a-cursor></a-cursor>
      </a-camera>
    </a-entity>

    <!-- Téléportation -->
    <script>
      const player = document.querySelector('#player');
      for (let i = 1; i <= 5; i++) {
        const zone = document.querySelector(`#teleport${i}`);
        zone.addEventListener('mouseenter', () => {
          console.log(`Vous avez franchi la porte ${i}`);
          // Téléportation temporaire vers une position plus loin dans le couloir
          player.setAttribute('position', { x: 0, y: 1.6, z: -30 - i*2 });
        });
      }
    </script>
  </a-scene>
</body>
</html>
