<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Couloir TSA - Index</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <!-- Scripts séparés pour modularité -->
  <script src="js/open-on-approach.js"></script>
  <script src="js/teleport.js"></script>
</head>
<body>
  <a-scene>
    <!-- Assets -->
    <a-assets>
      <a-asset-item id="doorModel" src="assets/door.glb"></a-asset-item>
    </a-assets>

    <!-- Couloir noir -->
    <a-box position="0 1.5 -25" depth="50" height="3" width="5" color="#000"></a-box>

    <!-- Portes + zones de téléportation -->
    <script>
      const scene = document.querySelector('a-scene');
      for (let i = 1; i <= 20; i++) {
        const zPos = -2.5 * i;

        // Porte miniature
        const door = document.createElement('a-entity');
        door.setAttribute('gltf-model', '#doorModel');
        door.setAttribute('position', `0 0 ${zPos}`);
        door.setAttribute('scale', '0.01 0.01 0.01'); // très fine
        door.setAttribute('open-on-approach', 'distance:2');
        scene.appendChild(door);

        // Zone de téléportation invisible
        const zone = document.createElement('a-box');
        zone.setAttribute('position', `0 1.6 ${zPos}`);
        zone.setAttribute('depth', '1');
        zone.setAttribute('height', '3');
        zone.setAttribute('width', '5');
        zone.setAttribute('visible', 'false');
        zone.setAttribute('id', `teleport${i}`);
        scene.appendChild(zone);
      }
    </script>

    <!-- Camera / joueur -->
    <a-entity id="player" position="0 1.6 0" camera wasd-controls look-controls>
      <a-camera>
        <a-cursor></a-cursor>
      </a-camera>
    </a-entity>

  </a-scene>

  <script>
    // Téléportation via zones invisibles
    const player = document.querySelector('#player');
    for (let i = 1; i <= 20; i++) {
      const zone = document.querySelector(`#teleport${i}`);
      zone.addEventListener('mouseenter', () => {
        console.log(`Vous avez franchi la porte ${i}`);
        // Téléportation vers une position temporaire (à remplacer par levelX.html plus tard)
        player.setAttribute('position', { x: 0, y: 1.6, z: -50 - i*2 });
      });
    }
  </script>
</body>
</html>
