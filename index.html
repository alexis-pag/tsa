<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Couloir TSA - 5 portes</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script>
    AFRAME.registerComponent('open-on-approach', {
      schema: { distance: { type: 'number', default: 2 } },
      tick: function () {
        const player = document.querySelector('#player');
        const doorPos = this.el.object3D.position;
        const playerPos = player.object3D.position;
        const dist = Math.sqrt(
          Math.pow(playerPos.x - doorPos.x, 2) +
          Math.pow(playerPos.z - doorPos.z, 2)
        );
        if (dist < this.data.distance) {
          this.el.setAttribute('rotation', '0 90 0'); // ouvre la porte
        } else {
          this.el.setAttribute('rotation', '0 0 0'); // ferme la porte
        }
      }
    });
  </script>
</head>
<body>
  <a-scene>
    <!-- Assets -->
    <a-assets>
      <a-asset-item id="doorModel" src="assets/door.glb"></a-asset-item>
    </a-assets>

    <!-- Couloir noir centré sur la caméra -->
    <a-box position="0 1.5 0" depth="20" height="3" width="5" color="#000"></a-box>

    <!-- Portes à l'intérieur du couloir -->
    <script>
      const scene = document.querySelector('a-scene');
      const numberOfDoors = 5;
      const startZ = -8; // première porte
      const spacing = 3; // espace entre les portes
      for (let i = 0; i < numberOfDoors; i++) {
        const zPos = startZ - i * spacing;

        // Porte GLB
        const door = document.createElement('a-entity');
        door.setAttribute('gltf-model', '#doorModel');
        door.setAttribute('position', `0 0 ${zPos}`);
        door.setAttribute('scale', '0.01 0.01 0.01');
        door.setAttribute('open-on-approach', 'distance:2');
        scene.appendChild(door);

        // Zone invisible pour téléportation
        const zone = document.createElement('a-box');
        zone.setAttribute('position', `0 1.6 ${zPos}`);
        zone.setAttribute('depth', '1');
        zone.setAttribute('height', '3');
        zone.setAttribute('width', '5');
        zone.setAttribute('visible', 'false');
        zone.setAttribute('id', `teleport${i+1}`);
        scene.appendChild(zone);
      }
    </script>

    <!-- Camera / joueur -->
    <a-entity id="player" position="0 1.6 2" camera wasd-controls look-controls>
      <a-camera>
        <a-cursor></a-cursor>
      </a-camera>
    </a-entity>

    <!-- Téléportation -->
    <script>
      const player = document.querySelector('#player');
      for (let i = 1; i <= 5; i++) {
        const zone = document.querySelector(`#teleport${i}`);
        zone.addEventListener('mouseenter', () => {
          console.log(`Franchi porte ${i}`);
          // Exemple : téléportation plus loin dans le couloir
          player.setAttribute('position', { x: 0, y: 1.6, z: -15 - i*2 });
        });
      }
    </script>
  </a-scene>
</body>
</html>
