<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Couloir TSA</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <!-- Composant : téléporte le joueur quand il traverse une porte -->
    <script>
      AFRAME.registerComponent("porte-teleport", {
        schema: {
          target: {type: "string"} // id de la destination
        },

        init: function () {
          const player = document.querySelector("#player");
          this.el.addEventListener("mouseenter", () => {
            const dest = document.querySelector(this.data.target);
            if (dest) {
              player.setAttribute("position", dest.getAttribute("position"));
            }
          });
        }
      });
    </script>

    <!-- Composant : génère automatiquement toutes les portes -->
    <script>
      AFRAME.registerComponent("generer-portes", {
        schema: {
          count: {type: "int", default: 20},
          spacing: {type: "number", default: 2}
        },

        init: function () {
          const scene = this.el;
          const data = this.data;

          for (let i = 0; i < data.count; i++) {
            const z = - (i * data.spacing + 5);

            const porte = document.createElement("a-box");
            porte.setAttribute("width", "1.5");
            porte.setAttribute("height", "2.5");
            porte.setAttribute("depth", "0.1");
            porte.setAttribute("color", "#222");
            porte.setAttribute("position", `0 1.25 ${z}`);
            porte.setAttribute("porte-teleport", `target: #tp${i}`);

            // Zone de destination
            const tp = document.createElement("a-entity");
            tp.setAttribute("id", `tp${i}`);
            tp.setAttribute("position", `0 1.6 ${z - 1}`);

            scene.appendChild(porte);
            scene.appendChild(tp);
          }
        }
      });
    </script>

  </head>

  <body>
    <a-scene>

      <!-- Joueur -->
      <a-entity id="player" position="0 1.6 0">
        <a-camera wasd-controls look-controls></a-camera>
      </a-entity>

      <!-- Couloir noir -->
      <a-box position="0 0 -50" width="4" height="3" depth="100" color="#000"></a-box>

      <!-- Génération automatique des portes -->
      <a-entity generer-portes="count: 20; spacing: 2"></a-entity>

    </a-scene>
  </body>
</html>
